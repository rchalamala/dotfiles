{{- $ext := .chezmoi.targetFile | ext -}}
{{- $env := dict
  "SSH_AUTH_SOCK" (.ssh.socket | replace "~" "$HOME")
  "EDITOR" "vim"
  "VISUAL" "vim"
  "HOMEBREW_NO_ENV_HINTS" "1"
  "HOMEBREW_BREWFILE" "$HOME/.local/share/chezmoi/Brewfile"
  "HOMEBREW_BREWFILE_CURSOR" "1"
  "HOMEBREW_BREWFILE_ON_REQUEST" "1"
  "HOMEBREW_BREWFILE_FULL_NAME" "1"
-}}
{{- $appendPaths := list
  "$HOME/.local/bin"
-}}
{{- if eq $ext ".fish" }}
eval (/opt/homebrew/bin/brew shellenv)
{{- range $key, $value := $env }}
set -gx {{ $key }} "{{ $value }}"
{{- end }}
{{- range $path := $appendPaths }}
fish_add_path -g "{{ $path }}"
{{- end }}
{{- else }}
{{- if not (hasSuffix "shrc" $ext) }}
eval "$(/opt/homebrew/bin/brew shellenv)"
{{- end }}
{{- range $key, $value := $env }}
export {{ $key }}="{{ $value }}"
{{- end }}
{{- range $path := $appendPaths }}
export PATH="$PATH:{{ $path }}"
{{- end }}
{{- end }}
