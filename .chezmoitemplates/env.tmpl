{{- $ext := splitList "." .chezmoi.targetFile | last -}}
{{- $filename := .chezmoi.targetFile | base -}}
{{- $env := dict
  "SSH_AUTH_SOCK" (output "sh" "-c" (printf "echo %s" .ssh.socket) | trim)
  "EDITOR" "vim"
  "VISUAL" "vim"
  "HOMEBREW_NO_ENV_HINTS" "1"
  "HOMEBREW_BREWFILE" (printf "%s/.local/share/chezmoi/Brewfile" .chezmoi.homeDir)
  "HOMEBREW_BREWFILE_CURSOR" "1"
  "HOMEBREW_BREWFILE_ON_REQUEST" "1"
  "HOMEBREW_BREWFILE_FULL_NAME" "1"
-}}
{{- $appendPaths := list
  (printf "%s/.local/bin" .chezmoi.homeDir)
-}}
{{- if eq $ext "fish" }}
eval (/opt/homebrew/bin/brew shellenv)
{{- range $key, $value := $env }}
set -gx {{ $key }} "{{ $value }}"
{{- end }}
{{- range $path := $appendPaths }}
fish_add_path -g "{{ $path }}"
{{- end }}
{{- else }}
{{- if not (regexMatch ".*shrc" $filename) }}
eval "$(/opt/homebrew/bin/brew shellenv)"
{{- end }}
{{- range $key, $value := $env }}
export {{ $key }}="{{ $value }}"
{{- end }}
{{- range $path := $appendPaths }}
export PATH="$PATH:{{ $path }}"
{{- end }}
{{- end }}
